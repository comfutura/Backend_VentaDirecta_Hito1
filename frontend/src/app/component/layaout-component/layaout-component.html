<!-- layout-component.html -->
<div class="layout-wrapper" [class.sidebar-collapsed]="isCollapsed" [class.mobile-open]="isMobileOpen">

  <!-- Sidebar Rojo-Azul -->
  <aside class="sidebar" [class.collapsed]="isCollapsed" [class.mobile-open]="isMobileOpen">

    <!-- Header con Logo -->
    <div class="sidebar-header">
      <div class="logo-container">
        <div class="logo-wrapper">
          <div *ngIf="logoUrl" class="logo-image-container">
            <img [src]="logoUrl" alt="Comfutura Logo" class="logo-image" />
          </div>
          <div *ngIf="!logoUrl" class="logo-fallback">
            <div class="logo-icon">
              <svg viewBox="0 0 32 32" fill="none">
                <rect x="4" y="4" width="24" height="24" rx="6" fill="url(#grad1)"/>
                <path d="M16 10L20 14L16 18L12 14L16 10Z" fill="white"/>
                <path d="M10 22L14 18L18 22L14 26L10 22Z" fill="white"/>
                <defs>
                  <linearGradient id="grad1" x1="0%" y1="0%" x2="100%" y2="100%">
                    <stop offset="0%" stop-color="#dc2626"/>
                    <stop offset="100%" stop-color="#2563eb"/>
                  </linearGradient>
                </defs>
              </svg>
            </div>
          </div>
        </div>

        <div class="logo-text-container" *ngIf="!isCollapsed">
          <h1 class="logo-text">COMFUTURA</h1>
          <span class="logo-subtitle">Gestión Integral</span>
        </div>
      </div>

      <button class="collapse-btn" (click)="toggleCollapse()" [title]="isCollapsed ? 'Expandir menú' : 'Contraer menú'">
        <i class="bi" [ngClass]="isCollapsed ? 'bi-chevron-double-right' : 'bi-chevron-double-left'"></i>
      </button>
    </div>

    <!-- Menú Navegación -->
    <nav class="sidebar-menu">
      <ul>
        <!-- Dashboard -->
        <li>
          <a routerLink="/dashboard" routerLinkActive="active" [routerLinkActiveOptions]="{ exact: true }"
             (click)="closeMobile()">
            <div class="menu-icon-wrapper">
              <i class="bi bi-speedometer2"></i>
            </div>
            <span class="menu-label" *ngIf="!isCollapsed">Dashboard</span>
            <span class="menu-badge" *ngIf="!isCollapsed && hasNotifications">3</span>
          </a>
        </li>

        <!-- Separador para gestión -->
        <li class="menu-divider" *ngIf="!isCollapsed">
          <span class="divider-label">Gestión Principal</span>
        </li>

        <!-- Órdenes de Trabajo -->
        <li>
          <a routerLink="/ot" routerLinkActive="active" (click)="closeMobile()">
            <div class="menu-icon-wrapper">
              <i class="bi bi-clipboard-check"></i>
            </div>
            <span class="menu-label" *ngIf="!isCollapsed">Órdenes de Trabajo</span>
          </a>
        </li>

        <!-- Sites -->
        <li>
          <a routerLink="/site" routerLinkActive="active" (click)="closeMobile()">
            <div class="menu-icon-wrapper">
              <i class="bi bi-geo-alt-fill"></i>
            </div>
            <span class="menu-label" *ngIf="!isCollapsed">Sites</span>
          </a>
        </li>

         <li>
          <a routerLink="/usuarios" routerLinkActive="active" (click)="closeMobile()">
            <div class="menu-icon-wrapper">
              <i class="bi bi-geo-alt-fill"></i>
            </div>
            <span class="menu-label" *ngIf="!isCollapsed">Usuarios</span>
          </a>
        </li>

        <!-- Gestión Jefatura/Analista -->
        <li>
          <a routerLink="/gestion-jefatura-analista" routerLinkActive="active" (click)="closeMobile()">
            <div class="menu-icon-wrapper">
              <i class="bi bi-person-gear"></i>
            </div>
            <span class="menu-label" *ngIf="!isCollapsed">Gestión Jefatura/Analista</span>
          </a>
        </li>

        <!-- Órdenes de Compra -->
        <li>
          <a routerLink="/orden-compra" routerLinkActive="active" (click)="closeMobile()">
            <div class="menu-icon-wrapper">
              <i class="bi bi-cart-check-fill"></i>
            </div>
            <span class="menu-label" *ngIf="!isCollapsed">Órdenes de Compra</span>
          </a>
        </li>

        <!-- Separador para administración -->
        <li class="menu-divider" *ngIf="!isCollapsed">
          <span class="divider-label">Administración</span>
        </li>

        <!-- Usuarios -->
        <li *ngIf="currentUser?.roles?.includes('ADMIN')">
          <a routerLink="/usuarios" routerLinkActive="active" (click)="closeMobile()">
            <div class="menu-icon-wrapper">
              <i class="bi bi-people-fill"></i>
            </div>
            <span class="menu-label" *ngIf="!isCollapsed">Usuarios</span>
          </a>
        </li>

        <!-- Trabajadores -->
        <li *ngIf="currentUser?.roles?.includes('ADMIN')">
          <a routerLink="/trabajador" routerLinkActive="active" (click)="closeMobile()">
            <div class="menu-icon-wrapper">
              <i class="bi bi-person-badge-fill"></i>
            </div>
            <span class="menu-label" *ngIf="!isCollapsed">Trabajadores</span>
          </a>
        </li>

        <!-- Configuración -->
        <li *ngIf="currentUser?.roles?.includes('ADMIN')">
          <a routerLink="/configuracion" routerLinkActive="active" (click)="closeMobile()">
            <div class="menu-icon-wrapper">
              <i class="bi bi-gear-fill"></i>
            </div>
            <span class="menu-label" *ngIf="!isCollapsed">Configuración</span>
          </a>
        </li>

        <!-- Reportes -->
        <li *ngIf="currentUser?.roles?.includes('ADMIN')">
          <a routerLink="/reportes" routerLinkActive="active" (click)="closeMobile()">
            <div class="menu-icon-wrapper">
              <i class="bi bi-graph-up"></i>
            </div>
            <span class="menu-label" *ngIf="!isCollapsed">Reportes</span>
          </a>
        </li>

        <!-- Separador para usuario -->
        <li class="menu-divider" *ngIf="!isCollapsed">
          <span class="divider-label">Mi Cuenta</span>
        </li>

        <!-- Perfil -->
        <li>
          <a routerLink="/perfil" routerLinkActive="active" (click)="closeMobile()">
            <div class="menu-icon-wrapper">
              <i class="bi bi-person-circle"></i>
            </div>
            <span class="menu-label" *ngIf="!isCollapsed">Mi Perfil</span>
          </a>
        </li>

        <!-- Configuración Personal -->
        <li>
          <a routerLink="/configuracion-personal" routerLinkActive="active" (click)="closeMobile()">
            <div class="menu-icon-wrapper">
              <i class="bi bi-sliders"></i>
            </div>
            <span class="menu-label" *ngIf="!isCollapsed">Configuración</span>
          </a>
        </li>
      </ul>
    </nav>

    <!-- Footer con Usuario -->
    <div class="sidebar-footer">
      <div class="user-profile" (click)="toggleUserMenu()" *ngIf="!isCollapsed">
        <div class="user-avatar" [ngClass]="userBadgeClass">
          {{ userInitial }}
          <div class="online-indicator"></div>
        </div>
        <div class="user-info">
          <div class="user-name">{{ nombreCompleto }}</div>
          <div class="user-role">{{ mainRole || 'Usuario' }}</div>
        </div>
        <i class="bi bi-chevron-down user-dropdown-icon" [class.rotated]="showUserMenu"></i>
      </div>

      <!-- Menú desplegable del usuario -->
      <div class="user-menu-dropdown" *ngIf="showUserMenu && !isCollapsed">
        <a routerLink="/perfil" (click)="closeUserMenu()">
          <i class="bi bi-person-circle"></i>
          <span>Mi Perfil</span>
        </a>
        <a routerLink="/configuracion-personal" (click)="closeUserMenu()">
          <i class="bi bi-sliders"></i>
          <span>Configuración</span>
        </a>
        <div class="user-menu-divider"></div>
        <a href="javascript:void(0)" (click)="logout(); closeUserMenu()" class="logout-menu-item">
          <i class="bi bi-box-arrow-right"></i>
          <span>Cerrar Sesión</span>
        </a>
      </div>

      <div class="logout-section" *ngIf="!isCollapsed && !showUserMenu">
        <button class="logout-btn" (click)="logout()">
          <i class="bi bi-box-arrow-right"></i>
          <span>Cerrar Sesión</span>
        </button>
      </div>

      <!-- Versión colapsada -->
      <div class="user-avatar-collapsed" *ngIf="isCollapsed" [ngClass]="userBadgeClass" (click)="toggleCollapse()">
        {{ userInitial }}
      </div>
    </div>
  </aside>

  <!-- Overlay móvil -->
  <div class="mobile-overlay" *ngIf="isMobileOpen" (click)="closeMobile()"></div>

  <!-- Contenido Principal -->
  <main class="main-content">
    <!-- Top Bar -->
    <header class="top-bar">
      <div class="top-bar-left">
        <button class="menu-toggle" (click)="toggleMobile()" aria-label="Alternar menú">
          <i class="bi bi-list"></i>
        </button>

        <button class="collapse-toggle" (click)="toggleCollapse()" *ngIf="!isMobileOpen">
          <i class="bi" [ngClass]="isCollapsed ? 'bi-chevron-double-right' : 'bi-chevron-double-left'"></i>
        </button>

        <div class="breadcrumb">
          <ng-content select="[breadcrumb]"></ng-content>
        </div>
      </div>

      <div class="top-bar-right">
        <!-- Notificaciones -->
        <button class="topbar-btn notification-btn" [class.has-notifications]="hasNotifications" (click)="toggleNotifications()">
          <i class="bi bi-bell"></i>
          <span class="notification-badge" *ngIf="hasNotifications">3</span>
        </button>

        <!-- Perfil de usuario -->
        <div class="user-dropdown">
          <div class="user-dropdown-trigger" (click)="toggleTopUserMenu()">
            <div class="user-mini-avatar" [ngClass]="userBadgeClass">
              {{ userInitial }}
            </div>
            <span class="user-mini-name">{{ nombreCompleto }}</span>
            <i class="bi bi-chevron-down"></i>
          </div>

          <!-- Menú desplegable top -->
          <div class="top-user-menu-dropdown" *ngIf="showTopUserMenu">
            <a routerLink="/perfil" (click)="closeTopUserMenu()">
              <i class="bi bi-person-circle"></i>
              <span>Mi Perfil</span>
            </a>
            <a routerLink="/configuracion-personal" (click)="closeTopUserMenu()">
              <i class="bi bi-sliders"></i>
              <span>Configuración</span>
            </a>
            <div class="user-menu-divider"></div>
            <a href="javascript:void(0)" (click)="logout(); closeTopUserMenu()" class="logout-menu-item">
              <i class="bi bi-box-arrow-right"></i>
              <span>Cerrar Sesión</span>
            </a>
          </div>
        </div>
      </div>
    </header>

    <!-- Notificaciones Panel -->
    <div class="notifications-panel" *ngIf="showNotifications">
      <div class="notifications-header">
        <h3>Notificaciones</h3>
        <button class="close-notifications" (click)="closeNotifications()">
          <i class="bi bi-x-lg"></i>
        </button>
      </div>
      <div class="notifications-list">
        <!-- Contenido de notificaciones -->
        <div class="notification-item unread">
          <div class="notification-icon">
            <i class="bi bi-check-circle-fill text-success"></i>
          </div>
          <div class="notification-content">
            <p class="notification-text">Orden de trabajo #1234 ha sido aprobada</p>
            <span class="notification-time">Hace 5 minutos</span>
          </div>
        </div>
        <div class="notification-item unread">
          <div class="notification-icon">
            <i class="bi bi-exclamation-circle-fill text-warning"></i>
          </div>
          <div class="notification-content">
            <p class="notification-text">Site "Los Olivos" requiere atención</p>
            <span class="notification-time">Hace 1 hora</span>
          </div>
        </div>
        <div class="notification-item">
          <div class="notification-icon">
            <i class="bi bi-info-circle-fill text-info"></i>
          </div>
          <div class="notification-content">
            <p class="notification-text">Nueva actualización del sistema disponible</p>
            <span class="notification-time">Ayer</span>
          </div>
        </div>
      </div>
      <div class="notifications-footer">
        <a routerLink="/notificaciones" (click)="closeNotifications()">Ver todas las notificaciones</a>
      </div>
    </div>

    <!-- Contenido de la Página -->
    <div class="content-wrapper">
      <div class="page-header">
        <h1 class="page-title">
          <ng-content select="[page-title]"></ng-content>
        </h1>
        <div class="page-actions">
          <ng-content select="[page-actions]"></ng-content>
        </div>
      </div>

      <div class="content-area">
        <router-outlet></router-outlet>
      </div>
    </div>
  </main>
</div>
