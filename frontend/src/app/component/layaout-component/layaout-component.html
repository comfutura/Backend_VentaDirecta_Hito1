<!-- layout-component.html -->
<div class="layout-wrapper" [class.sidebar-collapsed]="isCollapsed" [class.mobile-open]="isMobileOpen">

  <!-- Sidebar Rojo-Azul -->
  <aside class="sidebar" [class.collapsed]="isCollapsed" [class.mobile-open]="isMobileOpen">

    <!-- Header con Logo -->
    <div class="sidebar-header">
      <div class="logo-container">
        <div class="logo-wrapper">
          <div *ngIf="logoUrl" class="logo-image-container">
            <img src="https://res.cloudinary.com/dqznlmig0/image/upload/v1769211282/COMFUTURA_LOGOTIPO-02_ubswoz.png" alt="Comfutura Logo" class="logo-image" />
          </div>
          <div *ngIf="!logoUrl" class="logo-fallback">
            <div class="logo-icon">
              <svg viewBox="0 0 32 32" fill="none">
                <rect x="4" y="4" width="24" height="24" rx="6" fill="url(#grad1)"/>
                <path d="M16 10L20 14L16 18L12 14L16 10Z" fill="white"/>
                <path d="M10 22L14 18L18 22L14 26L10 22Z" fill="white"/>
                <defs>
                  <linearGradient id="grad1" x1="0%" y1="0%" x2="100%" y2="100%">
                    <stop offset="0%" stop-color="#dc2626"/>
                    <stop offset="100%" stop-color="#2563eb"/>
                  </linearGradient>
                </defs>
              </svg>
            </div>
          </div>
        </div>

        <div class="logo-text-container" *ngIf="!isCollapsed">
          <h1 class="logo-text">COMFUTURA</h1>
          <span class="logo-subtitle">Gestión Integral</span>
        </div>
      </div>

      <button class="collapse-btn" (click)="toggleCollapse()" [title]="isCollapsed ? 'Expandir menú' : 'Contraer menú'">
        <i class="bi" [ngClass]="isCollapsed ? 'bi-chevron-double-right' : 'bi-chevron-double-left'"></i>
      </button>
    </div>

    <!-- Menú Navegación -->
    <nav class="sidebar-menu">
      <ul>
        <!-- Dashboard -->
        <li>
          <a routerLink="/dashboard" routerLinkActive="active" [routerLinkActiveOptions]="{ exact: true }"
             (click)="closeMobile()">
            <div class="menu-icon-wrapper">
              <i class="bi bi-speedometer2"></i>
            </div>
            <span class="menu-label" *ngIf="!isCollapsed">Dashboard</span>
            <span class="menu-badge" *ngIf="!isCollapsed && hasNotifications">3</span>
          </a>
        </li>

        <!-- Órdenes de Trabajo -->
        <li>
          <a routerLink="/ot" routerLinkActive="active" (click)="closeMobile()">
            <div class="menu-icon-wrapper">
              <i class="bi bi-clipboard-check"></i>
            </div>
            <span class="menu-label" *ngIf="!isCollapsed">Órdenes de Trabajo</span>
          </a>
        </li>

        <!-- Sites -->
        <li>
          <a routerLink="/site" routerLinkActive="active" (click)="closeMobile()">
            <div class="menu-icon-wrapper">
              <i class="bi bi-geo-alt-fill"></i>
            </div>
            <span class="menu-label" *ngIf="!isCollapsed">Sites</span>
          </a>
        </li>

        <!-- Gestión -->
        <li>
          <a routerLink="/gestion-jefatura-analista" routerLinkActive="active" (click)="closeMobile()">
            <div class="menu-icon-wrapper">
              <i class="bi bi-person-gear"></i>
            </div>
            <span class="menu-label" *ngIf="!isCollapsed">Gestión</span>
          </a>
        </li>

        <!-- Órdenes de Compra -->
        <li>
          <a routerLink="/orden-compra" routerLinkActive="active" (click)="closeMobile()">
            <div class="menu-icon-wrapper">
              <i class="bi bi-cart-check-fill"></i>
            </div>
            <span class="menu-label" *ngIf="!isCollapsed">Órdenes de Compra</span>
          </a>
        </li>

        <!-- Separador para opciones de administración -->
        <li class="menu-divider" >
          <span class="divider-label">Administración</span>
        </li>

        <!-- Reportes (Solo Admin) -->
        <li >
          <a routerLink="/reportes" routerLinkActive="active" (click)="closeMobile()">
            <div class="menu-icon-wrapper">
              <i class="bi bi-graph-up"></i>
            </div>
            <span class="menu-label" *ngIf="!isCollapsed">Reportes</span>
          </a>
        </li>

        <!-- Configuración (Solo Admin) -->
        <li >
          <a routerLink="/configuracion" routerLinkActive="active" (click)="closeMobile()">
            <div class="menu-icon-wrapper">
              <i class="bi bi-gear-fill"></i>
            </div>
            <span class="menu-label" *ngIf="!isCollapsed">Configuración</span>
          </a>
        </li>
      </ul>
    </nav>

    <!-- Footer con Usuario -->
    <div class="sidebar-footer">
      <div class="user-profile" (click)="toggleMobile()" *ngIf="!isCollapsed">
        <div class="user-avatar" [ngClass]="userBadgeClass">
          {{ userInitial }}
          <div class="online-indicator"></div>
        </div>
        <div class="user-info">
          <div class="user-name">{{ username }}</div>
          <div class="user-role">{{ mainRole || 'Usuario' }}</div>
        </div>
        <i class="bi bi-chevron-down user-dropdown-icon"></i>
      </div>

      <div class="logout-section" *ngIf="!isCollapsed">
        <button class="logout-btn" (click)="logout()">
          <i class="bi bi-box-arrow-right"></i>
          <span>Cerrar Sesión</span>
        </button>
      </div>

      <!-- Versión colapsada -->
      <div class="user-avatar-collapsed" *ngIf="isCollapsed" [ngClass]="userBadgeClass" (click)="toggleCollapse()">
        {{ userInitial }}
      </div>
    </div>
  </aside>

  <!-- Overlay móvil -->
  <div class="mobile-overlay" *ngIf="isMobileOpen" (click)="closeMobile()"></div>

  <!-- Contenido Principal -->
  <main class="main-content">
    <!-- Top Bar -->
    <header class="top-bar">
      <div class="top-bar-left">
        <button class="menu-toggle" (click)="toggleMobile()" aria-label="Alternar menú">
          <i class="bi bi-list"></i>
        </button>

        <button class="collapse-toggle" (click)="toggleCollapse()" *ngIf="!isMobileOpen">
          <i class="bi" [ngClass]="isCollapsed ? 'bi-chevron-double-right' : 'bi-chevron-double-left'"></i>
        </button>

        <div class="breadcrumb">
          <ng-content select="[breadcrumb]"></ng-content>
        </div>
      </div>

      <div class="top-bar-right">
        <!-- Notificaciones -->
        <button class="topbar-btn notification-btn" [class.has-notifications]="hasNotifications">
          <i class="bi bi-bell"></i>
          <span class="notification-badge" *ngIf="hasNotifications">3</span>
        </button>

        <!-- Perfil de usuario -->
        <div class="user-dropdown">
          <div class="user-dropdown-trigger">
            <div class="user-mini-avatar" [ngClass]="userBadgeClass">
              {{ userInitial }}
            </div>
            <span class="user-mini-name">{{ username }}</span>
            <i class="bi bi-chevron-down"></i>
          </div>
        </div>
      </div>
    </header>

    <!-- Contenido de la Página -->
    <div class="content-wrapper">
      <div class="page-header">
        <h1 class="page-title">
          <ng-content select="[page-title]"></ng-content>
        </h1>
        <div class="page-actions">
          <ng-content select="[page-actions]"></ng-content>
        </div>
      </div>

      <div class="content-area">
        <router-outlet></router-outlet>
      </div>
    </div>
  </main>
</div>
