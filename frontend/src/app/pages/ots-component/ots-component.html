<div class="container-fluid py-4">
  <div class="card shadow-lg border-0 rounded-4">
    <!-- Header azul elegante -->
    <div class="card-header bg-gradient-primary text-white d-flex align-items-center gap-3 py-4">
      <i class="bi bi-file-earmark-text fs-3"></i>
      <div>
        <h4 class="mb-0 fw-semibold">Órdenes de Trabajo</h4>
        <small class="opacity-75">Gestión y seguimiento de OTs</small>
      </div>
    </div>

    <div class="card-body p-4">
      <!-- Controles superiores -->
      <div class="d-flex flex-wrap gap-3 mb-4 align-items-end">
        <div class="flex-grow-1">
          <label class="form-label fw-semibold">Estado</label>
          <select class="form-select w-auto" [(ngModel)]="activoFilter" (change)="onFilterChange()">
            <option [ngValue]="null">Todas</option>
            <option [ngValue]="true">Activas</option>
            <option [ngValue]="false">Inactivas</option>
          </select>
        </div>

        <button class="btn btn-primary btn-lg d-flex align-items-center gap-2" (click)="goToCreate()">
          <i class="bi bi-plus-lg"></i>
          Nueva Orden
        </button>
      </div>

      <!-- Loading -->
      <div *ngIf="loading" class="text-center py-5">
        <div class="spinner-border text-primary" role="status" style="width: 3rem; height: 3rem;">
          <span class="visually-hidden">Cargando...</span>
        </div>
        <p class="mt-3 text-muted">Cargando órdenes de trabajo...</p>
      </div>

      <!-- Error -->
      <div *ngIf="errorMessage" class="alert alert-danger alert-dismissible fade show" role="alert">
        {{ errorMessage }}
        <button type="button" class="btn-close" (click)="errorMessage = null"></button>
      </div>

      <!-- Contenido principal -->
      <div *ngIf="!loading && otsPage">
        <!-- No hay datos -->
        <div *ngIf="dataSource.length === 0" class="text-center py-5">
          <i class="bi bi-clipboard-x display-1 text-muted"></i>
          <p class="mt-3 text-muted fs-5">No se encontraron órdenes de trabajo</p>
        </div>

        <!-- Tabla -->
        <div *ngIf="dataSource.length > 0" class="table-responsive">
          <table class="table table-hover align-middle">
            <thead class="table-light">
              <tr>
                <th scope="col">N° OT</th>
                <th scope="col">Descripción</th>
                <th scope="col">Creación</th>
                <th scope="col" class="text-center">Estado</th>
                <th scope="col" class="text-center">Acciones</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let ot of dataSource">
                <td class="fw-semibold text-primary">{{ ot.ot }}</td>
                <td>{{ ot.descripcion || '—' }}</td>
                <td>{{ ot.fechaCreacion | date:'dd MMM yyyy • HH:mm' }}</td>
                <td class="text-center">
                  <span class="badge rounded-pill px-3 py-2"
                        [ngClass]="ot.activo ? 'bg-success' : 'bg-danger'">
                    {{ ot.activo ? 'Activa' : 'Inactiva' }}
                  </span>
                </td>
                <td class="text-center">
  <!-- Ver detalle -->
  <button class="btn btn-sm btn-outline-primary rounded-circle me-2"
          (click)="viewDetail(ot)"
          title="Ver detalle">
    <i class="bi bi-eye"></i>
  </button>

  <!-- Toggle -->
  <button class="btn btn-sm rounded-pill px-3 py-1 fw-semibold"
          [ngClass]="{
            'btn-outline-danger': ot.activo,
            'btn-outline-success': !ot.activo
          }"
          (click)="toggleEstado(ot)"
          title="{{ ot.activo ? 'Desactivar OT' : 'Activar OT' }}">
    {{ ot.activo ? 'Desactivar' : 'Activar' }}
  </button>
</td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- Paginación empresarial -->
        <div *ngIf="totalElements > 0" class="d-flex flex-column flex-md-row justify-content-between align-items-center gap-3 mt-4">
          <div class="text-muted">
            Mostrando {{ dataSource.length }} de {{ totalElements }} registros
          </div>

          <nav aria-label="Paginación">
            <ul class="pagination mb-0">
              <li class="page-item" [class.disabled]="pageIndex === 0">
                <button class="page-link" (click)="goToFirst()" aria-label="Primera">
                  <i class="bi bi-chevron-double-left"></i>
                </button>
              </li>
              <li class="page-item" [class.disabled]="pageIndex === 0">
                <button class="page-link" (click)="goToPrevious()">
                  <i class="bi bi-chevron-left"></i>
                </button>
              </li>

              <li class="page-item" *ngFor="let p of visiblePages"
                  [class.active]="p === pageIndex">
                <button class="page-link" (click)="goToPage(p)">
                  {{ p + 1 }}
                </button>
              </li>

              <li class="page-item" [class.disabled]="pageIndex >= totalPages - 1">
                <button class="page-link" (click)="goToNext()">
                  <i class="bi bi-chevron-right"></i>
                </button>
              </li>
              <li class="page-item" [class.disabled]="pageIndex >= totalPages - 1">
                <button class="page-link" (click)="goToLast()" aria-label="Última">
                  <i class="bi bi-chevron-double-right"></i>
                </button>
              </li>
            </ul>
          </nav>

          <div class="d-flex align-items-center gap-2">
            <label class="form-label mb-0 me-2">Filas:</label>
            <select class="form-select form-select-sm w-auto"
                    [(ngModel)]="pageSize"
                    (change)="changePageSize(pageSize)">
              <option value="5">5</option>
              <option value="10">10</option>
              <option value="15">15</option>
              <option value="25">25</option>
              <option value="50">50</option>
            </select>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
