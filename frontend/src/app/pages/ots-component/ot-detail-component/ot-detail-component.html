<div class="ot-detail-container">
  <!-- Header -->
  <div class="detail-header">
    <div class="container-fluid px-4">
      <div class="d-flex flex-column flex-lg-row justify-content-between align-items-start align-items-lg-center gap-3 mb-4">
        <div class="flex-grow-1">
          <div class="d-flex align-items-center gap-3 mb-2">
            <div class="icon-circle bg-primary-gradient">
              <i class="bi bi-file-earmark-check text-white"></i>
            </div>
            <div>
              <h1 class="ot-title mb-1">OT #{{ ot?.ot ?? '——' }}</h1>
              <div class="d-flex align-items-center gap-2 flex-wrap">
                <span class="badge status-badge" [ngClass]="getEstadoBadgeClass(ot?.estadoOt)">
                  {{ ot?.estadoOt || 'SIN ESTADO' }}
                </span>
                <span class="text-muted fs-6">
                  <i class="bi bi-calendar3 me-1"></i>
                  {{ ot?.fechaApertura ? (ot?.fechaApertura | date:'dd/MM/yyyy') : '—' }}
                </span>
              </div>
            </div>
          </div>
          
          <p class="ot-description text-muted mb-0">
            {{ ot?.descripcion || 'Sin descripción disponible' }}
          </p>
        </div>
        
        <div class="d-flex flex-wrap gap-2">
          <div class="d-flex flex-column align-items-end">
            <span class="badge bg-light text-dark fs-6 px-3 py-2">
              <i class="bi bi-clock me-1"></i>
              {{ ot?.diasAsignados ?? '—' }} día{{ (ot?.diasAsignados ?? 0) !== 1 ? 's' : '' }}
            </span>
            <span class="badge fs-6 px-3 py-2 mt-1"
                  [ngClass]="ot?.activo ? 'bg-success' : 'bg-secondary'">
              <i class="bi me-1" [ngClass]="ot?.activo ? 'bi-toggle-on' : 'bi-toggle-off'"></i>
              {{ ot?.activo ? 'Activa' : 'Inactiva' }}
            </span>
          </div>
        </div>
      </div>
      
      <!-- Timeline -->
      <div class="timeline-container mb-4">
        <h6 class="timeline-title mb-3">
          <i class="bi bi-diagram-3 me-2"></i>Progreso de la OT
        </h6>
        <div class="timeline-track">
          <div class="timeline-line"></div>
          <div class="timeline-items">
            <ng-container *ngFor="let estado of estados; let i = index">
              <div class="timeline-item" [class.active]="i === currentEstadoIndex" 
                   [class.completed]="i < currentEstadoIndex" [class.pending]="i > currentEstadoIndex">
                <div class="timeline-marker">
                  <i class="bi" [ngClass]="getIconoEstado(i)"></i>
                </div>
                <div class="timeline-label">{{ estado }}</div>
                <div class="timeline-step">{{ i + 1 }}</div>
              </div>
            </ng-container>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Loading -->
  <div *ngIf="loading" class="loading-container">
    <div class="spinner-container">
      <div class="spinner-border text-primary" style="width: 3rem; height: 3rem;"></div>
      <h5 class="mt-4">Cargando información de la OT...</h5>
    </div>
  </div>

  <!-- Contenido principal -->
  <div *ngIf="!loading && ot" class="detail-content">
    <div class="container-fluid px-4">
      <div class="row g-4">
        <!-- Columna 1: Información básica -->
        <div class="col-lg-4">
          <div class="info-card">
            <div class="card-header">
              <i class="bi bi-building me-2"></i>Información del Cliente
            </div>
            <div class="card-body">
              <div class="info-row">
                <span class="info-label">Cliente</span>
                <span class="info-value">{{ ot.clienteRazonSocial || '—' }}</span>
              </div>
              <div class="info-row">
                <span class="info-label">Área</span>
                <span class="info-value">{{ ot.areaNombre || '—' }}</span>
              </div>
              <div class="info-row">
                <span class="info-label">Proyecto</span>
                <span class="info-value">{{ ot.proyectoNombre || '—' }}</span>
              </div>
              <div class="info-row">
                <span class="info-label">Fase</span>
                <span class="info-value">{{ ot.faseNombre || '—' }}</span>
              </div>
              <div class="info-row">
                <span class="info-label">Site</span>
                <span class="info-value">{{ ot.siteNombre || '—' }}</span>
              </div>
              <div class="info-row">
                <span class="info-label">Región</span>
                <span class="info-value">{{ ot.regionNombre || '—' }}</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Columna 2: Fechas y seguimiento -->
        <div class="col-lg-4">
          <div class="info-card">
            <div class="card-header">
              <i class="bi bi-calendar-week me-2"></i>Seguimiento
            </div>
            <div class="card-body">
              <div class="info-row">
                <span class="info-label">ID Interno</span>
                <span class="info-value badge bg-light text-dark">#{{ ot.idOts }}</span>
              </div>
              <div class="info-row">
                <span class="info-label">Fecha de apertura</span>
                <span class="info-value">{{ ot.fechaApertura ? (ot.fechaApertura | date:'dd/MM/yyyy') : '—' }}</span>
              </div>
              <div class="info-row">
                <span class="info-label">Fecha de creación</span>
                <span class="info-value">{{ ot.fechaCreacion ? (ot.fechaCreacion | date:'dd/MM/yyyy HH:mm') : '—' }}</span>
              </div>
              <div class="info-row">
                <span class="info-label">Días asignados</span>
                <span class="info-value">{{ ot.diasAsignados || '—' }}</span>
              </div>
              <div class="info-row">
                <span class="info-label">Estado actual</span>
                <span class="info-value">
                  <span class="badge" [ngClass]="getEstadoBadgeClass(ot.estadoOt)">
                    {{ ot.estadoOt || '—' }}
                  </span>
                </span>
              </div>
              <div class="info-row">
                <span class="info-label">Activa</span>
                <span class="info-value">
                  <span class="badge" [ngClass]="ot.activo ? 'bg-success' : 'bg-secondary'">
                    {{ ot.activo ? 'Sí' : 'No' }}
                  </span>
                </span>
              </div>
            </div>
          </div>
        </div>

        <!-- Columna 3: Responsables -->
        <div class="col-lg-4">
          <div class="info-card">
            <div class="card-header">
              <i class="bi bi-people-fill me-2"></i>Equipo Responsable
            </div>
            <div class="card-body">
              <div class="info-row">
                <span class="info-label">Creador</span>
                <span class="info-value">{{ ot.creadorNombre || '—' }}</span>
              </div>
              <div class="info-row">
                <span class="info-label">Cliente solicitante</span>
                <span class="info-value">{{ ot.jefaturaClienteSolicitanteNombre || '—' }}</span>
              </div>
              <div class="info-row">
                <span class="info-label">Analista cliente</span>
                <span class="info-value">{{ ot.analistaClienteSolicitanteNombre || '—' }}</span>
              </div>
              <div class="info-row">
                <span class="info-label">Coordinador TI/CW</span>
                <span class="info-value">{{ ot.coordinadorTiCwNombre || '—' }}</span>
              </div>
              <div class="info-row">
                <span class="info-label">Jefatura responsable</span>
                <span class="info-value">{{ ot.jefaturaResponsableNombre || '—' }}</span>
              </div>
              <div class="info-row">
                <span class="info-label">Liquidador</span>
                <span class="info-value">{{ ot.liquidadorNombre || '—' }}</span>
              </div>
              <div class="info-row">
                <span class="info-label">Ejecutante</span>
                <span class="info-value">{{ ot.ejecutanteNombre || '—' }}</span>
              </div>
              <div class="info-row">
                <span class="info-label">Analista contable</span>
                <span class="info-value">{{ ot.analistaContableNombre || '—' }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Error o no encontrado -->
  <div *ngIf="!loading && !ot" class="error-container">
    <div class="error-content">
      <i class="bi bi-exclamation-octagon-fill"></i>
      <h4>Orden de trabajo no encontrada</h4>
      <p class="text-muted">La OT solicitada no existe o no tienes permisos para verla.</p>
      <button class="btn btn-outline-primary" (click)="volver()">
        <i class="bi bi-arrow-left me-2"></i>Volver al listado
      </button>
    </div>
  </div>

  <!-- Footer -->
  <div class="detail-footer">
    <div class="container-fluid px-4">
      <div class="d-flex justify-content-center gap-3">
        <button class="btn btn-outline-secondary" (click)="volver()">
          <i class="bi bi-arrow-left me-2"></i>Volver
        </button>
        <button *ngIf="ot" class="btn btn-primary" (click)="editarOt()">
          <i class="bi bi-pencil-square me-2"></i>Editar OT
        </button>
      </div>
    </div>
  </div>
</div>