<div class="ot-detail-modal-container">
  <!-- Header con botón cerrar -->
  <div class="detail-header">
    <div class="container-fluid px-4">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <div class="d-flex align-items-center gap-3">
          <div class="icon-circle bg-primary-gradient shadow-sm">
            <i class="bi bi-file-earmark-text text-white fs-4"></i>
          </div>
          <div>
            <h1 class="ot-title mb-0">OT #{{ ot?.ot ?? '——' }}</h1>
            <p class="ot-subtitle text-white opacity-75 mb-0">
              {{ ot?.descripcion || 'Sin descripción disponible' }}
            </p>
          </div>
        </div>
        
        <div class="d-flex align-items-center gap-3">
          <div class="text-end">
            <div class="badge status-badge fs-6 fw-normal px-3 py-2"
                 [ngClass]="getEstadoBadgeClass(ot?.estadoOt)">
              <i class="bi me-1" [ngClass]="getEstadoIcon(ot?.estadoOt)"></i>
              {{ ot?.estadoOt || 'SIN ESTADO' }}
            </div>
            <div class="text-white opacity-75 mt-1 small">
              <i class="bi bi-calendar3 me-1"></i>
              {{ ot?.fechaApertura ? (ot?.fechaApertura | date:'dd/MM/yyyy') : '—' }}
            </div>
          </div>
          
          <!-- Botón cerrar -->
          <button type="button" class="btn-close btn-close-white btn-close-lg"
                  (click)="onClose()" aria-label="Cerrar">
          </button>
        </div>
      </div>

      <!-- Barra de progreso -->
      <div class="progress-bar-container mb-4">
        <div class="d-flex justify-content-between mb-2">
          <span class="text-white opacity-85 small">
            Progreso: {{ currentEstadoIndex + 1 }} de {{ estados.length }} estados
          </span>
          <span class="text-white opacity-85 small fw-medium">
            {{ progressPercentage }}%
          </span>
        </div>
        <div class="progress bg-white bg-opacity-20" style="height: 8px;">
          <div class="progress-bar bg-white progress-bar-striped progress-bar-animated" 
               role="progressbar" 
               [style.width.%]="progressPercentage"
               [attr.aria-valuenow]="progressPercentage">
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Loading -->
  <div *ngIf="loading" class="loading-container">
    <div class="spinner-container">
      <div class="spinner-border text-primary" style="width: 3rem; height: 3rem;"></div>
      <h5 class="mt-3 text-primary fw-medium">Cargando información de la OT...</h5>
    </div>
  </div>

  <!-- Contenido principal con scroll -->
  <div *ngIf="!loading && ot" class="detail-content-wrapper">
    <div class="detail-content">
      <div class="container-fluid px-4">
        <div class="row g-4 mb-5">
          <!-- Información del Cliente -->
          <div class="col-lg-6">
            <div class="info-section-card">
              <div class="section-header">
                <i class="bi bi-building text-primary me-2"></i>
                Información del Proyecto
              </div>
              <div class="section-body">
                <div class="info-grid">
                  <div class="info-item">
                    <span class="info-label">Cliente</span>
                    <span class="info-value highlight">
                      {{ ot.clienteRazonSocial || '—' }}
                    </span>
                  </div>
                  <div class="info-item">
                    <span class="info-label">Área</span>
                    <span class="info-value">{{ ot.areaNombre || '—' }}</span>
                  </div>
                  <div class="info-item">
                    <span class="info-label">Proyecto</span>
                    <span class="info-value">{{ ot.proyectoNombre || '—' }}</span>
                  </div>
                  <div class="info-item">
                    <span class="info-label">Fase</span>
                    <span class="info-value">{{ ot.faseNombre || '—' }}</span>
                  </div>
                  <div class="info-item">
                    <span class="info-label">Site</span>
                    <span class="info-value">{{ ot.siteNombre || '—' }}</span>
                  </div>
                  <div class="info-item">
                    <span class="info-label">Región</span>
                    <span class="info-value">{{ ot.regionNombre || '—' }}</span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Información de Seguimiento -->
          <div class="col-lg-6">
            <div class="info-section-card">
              <div class="section-header">
                <i class="bi bi-calendar-check text-primary me-2"></i>
                Seguimiento y Estado
              </div>
              <div class="section-body">
                <div class="info-grid">
                  <div class="info-item">
                    <span class="info-label">ID Interno</span>
                    <span class="info-value badge bg-primary-subtle text-primary">#{{ ot.idOts }}</span>
                  </div>
                  <div class="info-item">
                    <span class="info-label">Fecha Apertura</span>
                    <span class="info-value">{{ formatDate(ot.fechaApertura) }}</span>
                  </div>
                  <div class="info-item">
                    <span class="info-label">Creado el</span>
                    <span class="info-value">{{ formatDateTime(ot.fechaCreacion) }}</span>
                  </div>
                  <div class="info-item">
                    <span class="info-label">Días Asignados</span>
                    <span class="info-value fw-bold">{{ ot.diasAsignados || '—' }} días</span>
                  </div>
                  <div class="info-item">
                    <span class="info-label">Estado</span>
                    <span class="info-value">
                      <span class="badge status-sm" [ngClass]="getEstadoBadgeClass(ot.estadoOt)">
                        {{ ot.estadoOt || '—' }}
                      </span>
                    </span>
                  </div>
                  <div class="info-item">
                    <span class="info-label">Actividad</span>
                    <span class="info-value">
                      <span class="badge" [ngClass]="ot.activo ? 'bg-success' : 'bg-secondary'">
                        {{ ot.activo ? 'Activa' : 'Inactiva' }}
                      </span>
                    </span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Equipo Responsable -->
        <div class="info-section-card mb-4">
          <div class="section-header">
            <i class="bi bi-people text-primary me-2"></i>
            Equipo Responsable
          </div>
          <div class="section-body">
            <div class="row g-4">
              <div class="col-md-6">
                <h6 class="section-subtitle mb-3">
                  <i class="bi bi-building me-2"></i>Lado Cliente
                </h6>
                <div class="info-grid">
                  <div class="info-item">
                    <span class="info-label">Creador</span>
                    <span class="info-value">{{ ot.creadorNombre || '—' }}</span>
                  </div>
                  <div class="info-item">
                    <span class="info-label">Jefatura Cliente</span>
                    <span class="info-value">{{ ot.jefaturaClienteSolicitanteNombre || '—' }}</span>
                  </div>
                  <div class="info-item">
                    <span class="info-label">Analista Cliente</span>
                    <span class="info-value">{{ ot.analistaClienteSolicitanteNombre || '—' }}</span>
                  </div>
                </div>
              </div>
              
              <div class="col-md-6">
                <h6 class="section-subtitle mb-3">
                  <i class="bi bi-gear me-2"></i>Lado Ejecutivo
                </h6>
                <div class="info-grid">
                  <div class="info-item">
                    <span class="info-label">Coordinador TI/CW</span>
                    <span class="info-value">{{ ot.coordinadorTiCwNombre || '—' }}</span>
                  </div>
                  <div class="info-item">
                    <span class="info-label">Jefatura Responsable</span>
                    <span class="info-value">{{ ot.jefaturaResponsableNombre || '—' }}</span>
                  </div>
                  <div class="info-item">
                    <span class="info-label">Liquidador</span>
                    <span class="info-value">{{ ot.liquidadorNombre || '—' }}</span>
                  </div>
                  <div class="info-item">
                    <span class="info-label">Ejecutante</span>
                    <span class="info-value">{{ ot.ejecutanteNombre || '—' }}</span>
                  </div>
                  <div class="info-item">
                    <span class="info-label">Analista Contable</span>
                    <span class="info-value">{{ ot.analistaContableNombre || '—' }}</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Timeline mejorada -->
        <div class="info-section-card">
          <div class="section-header">
            <i class="bi bi-diagram-3 text-primary me-2"></i>
            Flujo de Trabajo
          </div>
          <div class="section-body">
            <div class="timeline-horizontal">
              <div class="timeline-track">
                <div class="timeline-line"></div>
                <div class="timeline-items">
                  <ng-container *ngFor="let estado of estados; let i = index">
                    <div class="timeline-step" 
                         [class.completed]="i <= currentEstadoIndex"
                         [class.current]="i === currentEstadoIndex"
                         [class.future]="i > currentEstadoIndex"
                         [class.cancelled]="ot.estadoOt === 'CANCELADA' && i === estados.length - 1">
                      
                      <div class="timeline-marker">
                        <i class="bi" [ngClass]="getIconoEstado(i)"></i>
                      </div>
                      
                      <div class="timeline-content">
                        <div class="timeline-label">{{ estado }}</div>
                        <div class="timeline-status">
                          <span *ngIf="i === currentEstadoIndex" class="current-status">
                            Actual
                          </span>
                          <span *ngIf="i < currentEstadoIndex" class="completed-status">
                            Completado
                          </span>
                        </div>
                      </div>
                    </div>
                  </ng-container>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Error o no encontrado -->
  <div *ngIf="!loading && !ot" class="error-container">
    <div class="error-content text-center">
      <div class="error-icon">
        <i class="bi bi-exclamation-octagon-fill"></i>
      </div>
      <h4 class="error-title">Orden de trabajo no encontrada</h4>
      <p class="error-message">La OT solicitada no existe o no tienes permisos para verla.</p>
      <button class="btn btn-outline-primary px-4" (click)="onClose()">
        <i class="bi bi-arrow-left me-2"></i>Volver al listado
      </button>
    </div>
  </div>

  <!-- Footer con acciones -->
  <div class="detail-footer">
    <div class="container-fluid px-4">
      <div class="d-flex justify-content-between align-items-center">
        <div class="text-muted small">
          <i class="bi bi-info-circle me-1"></i>
          ID Interno: {{ ot?.idOts || '—' }} • Última actualización: {{ formatDateTime(ot?.fechaCreacion) }}
        </div>
        
        <div class="d-flex gap-3">
          <button class="btn btn-outline-secondary px-4" (click)="onClose()">
            <i class="bi bi-x-lg me-2"></i>Cerrar
          </button>
          <button *ngIf="ot" class="btn btn-primary px-4" (click)="editarOt()">
            <i class="bi bi-pencil-square me-2"></i>Editar OT
          </button>
        </div>
      </div>
    </div>
  </div>
</div>